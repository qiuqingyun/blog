---
title: 论安全计算的部署：具有Cardinality的隐私集合交点求和问题 Part2
---

## 2 问题的设定

我们现在描述问题的细节和我们的部署环境，包括正式的问题陈述和它的特点，我们的执行环境和日常工作负载的估计，以及我们用于协议的货币成本模型。

### 2.1 正式的问题陈述

在图1中，我们给出了一个关于我们旨在安全计算的功能的正式描述。在附录G中，我们还描述了一个反向的变体，即P1代替P2学习交集和S。我们的部署还假设双方已经拥有相同标识符空间的数据。找到一个适当的共同标识符空间是一个重要的问题，与当前的工作正交。

……

### 2.2 问题特征和制约因素

在这一节中，我们讨论了我们的部署所解决的业务问题的各种特征，即计算广告转化率指标。我们首先考虑使该问题适合于安全计算解决方案的特点。

……

### 2.3 对抗模型

另一个重要的设计轴是安全计算应该保护哪一类恶意行为。

我们可以用各种不同的模型来设计我们的协议，其中两个极端是完全信任和恶意对手模型。完全信任意味着各方相信对方会在明确的情况下正确计算数据，并在协议结束后删除数据。另一方面，恶意对手被允许任意地偏离任何规定的协议。在这两个极端之间存在中间概念，其中一个重要的概念是针对诚实但好奇的对手的安全性。提供 "诚实可信"（或半诚实）安全的协议，（在[58]中建模）假定参与者将诚实地遵循协议步骤，但可能试图从各种协议消息的记录本和日志中尽可能多地了解。

虽然对更强大的对手的保护自然更有吸引力，但它确实伴随着大量的效率成本（尤其是通信）。此外，加密协议的安全模型是全面风险分析的一部分，其中包括各方偏离的动机、基础数据的性质、互动各方之间的信任规模和水平，以及外部执行机制的可用性，如合同或代码审计。与恶意安全模型的协议相比，半诚实模型有相对有效的解决方案可用，特别是在通信成本和货币成本方面。它也是对完全信任模型的重大改进，该模型依靠外部非加密机制来确保隐私。特别是，半诚实模型对任何一方的数据泄露都给予了强有力的隐私保护，因为，由于半诚实的协议日志在规定的协议输出之外没有任何泄露。

在我们的部署中，考虑到所有因素，我们选择了 "半诚实 "的安全目标。

### 2.4 工作负载和执行环境

我们部署的一个典型的日常工作负载涉及每对当事人之间约1000个协议的执行，每个执行涉及每方输入中的100，000个项目。

我们的应用不是实时的，因此我们的部署环境是对延迟不敏感的批量计算的代表。每一方都控制着自己的计算和存储资源，此外，双方都可以访问共享的存储资源，用于传输协议执行的中间步骤的数据。1000个协议执行中的每一个都在共享存储中被分配了一个单独的目录。每当一方完成了某一特定执行的回合，它就将回合结果写入该执行的共享目录中。每一方都以相对较长的延迟（几分钟左右）不断轮询共享存储中的这些目录，以检查是否有新的文件被写入，如果有，就执行相应协议的下一轮执行。执行以这种方式继续，直到所有的执行都完成。

各方在他们自己的数据中心执行他们的协议部分。中间协议数据在这些数据中心之间使用互联网上的标准SSL连接进行传输。

### 2.5 货币成本模型

我们使用协议执行的总货币成本作为我们的主要成本指标。

……

### 2.6 相关工作

在实践中部署安全计算是具有挑战性的，但也有一些现实世界的应用利用了MPC。其中包括丹麦的甜菜拍卖[6]、爱沙尼亚的一个金融应用[5]、马萨诸塞州大学教师工资的安全调查[39]，以及一个报告骚扰行为的平台[54]。最近，Lindell等人[2]，[28]为在单一组织拥有的机器之间运行的加密操作部署了安全计算。谷歌也报告了使用安全计算协议来聚合来自移动设备的本地训练的机器学习模型[7]。然而，组织在多个实体或企业之间常规使用安全计算的情况仍然很少。

## 3 已部署的协议

在本节中，我们描述了我们部署的协议，即基于DDH的协议。

### 3.1 协议细节

在这里，我们提出了我们的基于DDH的相交和协议，这是我们针对上述限制条件而设计的。根据我们的理解，我们的协议是解决相交和问题的最简单的协议。它使用了众所周知的基于经典假设的加密基元，并可以从广泛部署的库（如OpenSSL）中构建。它的目标是半诚实的安全，并旨在最大限度地减少通信成本。此外，它足够灵活，允许几个重要的变体。

……

### 3.2 参数选择

在我们的部署中，我们使用OpenSSL的实现 "prime256v1"，一个具有256位群元素的NIST椭圆曲线，作为群G。对于随机神谕，我们使用SHA-256应用于输入，并重新应用，直到产生的输出位于椭圆曲线3上。为了在每次执行时模拟一个新的随机神谕，双方选择一个共同的随机种子，并在散列前将其预加到每个输入中。

对于加法同态加密方案，我们使用768位素数的Paillier加密，采用Damgard-Jurik优化[16]，s=3。因此，每个密码文本为6144位，明文空间为4608位。我们假设每个相关的整数值最多为32位，包括求和之后，因此我们可以将许多值打包到一个密码文本中。开槽的细节可以在附录B.1中看到。在槽之间允许40位的屏蔽，并留出一半的明文空间以允许槽被移位和添加，我们可以将65个整数值打包到一个密码文中。我们的Paillier实现是建立在OpenSSL的BigNum库之上的。

### 3.3 部署成本

在表2中，我们给出了单次会话的通信和计算成本，其中每一方的数据库中有100,000个条目，以及1000次这样的会议，这大致相当于一天的工作量。此外，我们使用表1中给出的GCP的资源估值给出了美元成本。运行时间是双方的总和，是在一台配备英特尔至强CPU E5-1650 v3（3.50 GHz）的台式工作站的单核上测量的，这在我们的部署中是典型的机器，也是谷歌云平台的虚拟CPU的代表。

我们看到，尽管原始计算时间似乎相当大，而通信相对适中，但通信的成本要比美元成本高3倍，占协议货币成本的75%。

### 3.4 变体

我们考虑了该协议在不同背景下的变体。这些变体对功能进行了修改，提供了重要的灵活性。

……

## 4 重新审视这个问题：新协议

在这一节中，我们转向这项工作的第二个主要贡献，即根据PSI协议的大量最新进展，重新审视安全计算私有交集-和-基数的问题。我们给出了两个基于新方法的新协议。此外，我们描述了一个简单的配方，将PSI协议的一个特别常见的味道变成一个具有Cardinality的隐私集合交点求和协议。

### 4.1 隐私集合求交集：概述

在一长串的工作中[14]、[15]、[17]、[20]、[22]、[26]、[32]、[33]、[37]、[38]、[49]、[52]、[55]、[56]已经广泛地研究了私有集相交。有几项工作将各方限制在只学习交集的cardinality [1], [13], [26], [33], [36], [44], [57] 。

……

### 4.2 将PSI转化为PIS：标签、洗牌和聚合

正如介绍中所讨论的，私有相交和的问题可以被看作是私有集合相交功能的扩展，此外，PSI功能是我们功能的一个隐含组成部分。因此，我们构造的自然起点是现有的PSI协议（我们部署的协议和我们的新构造都是如此）。我们从隐私集合求交集(PSI)到隐私集合交点求和(PIS)的高级秘诀如下：

……

### 4.3 具有Cardinality的隐私集合交点求和的新协议

在这一节中，我们介绍了我们的新加密协议，用于具有Cardinality的隐私集合交点求和，它利用了最近的ROT和BF技术，用于集合相交。

#### 4.3.1 基于随机OT的协议

在这一节中，我们描述了一个基于随机OT的相交和协议，它被用于现有的PSI解决方案中[20], [49], [52], [55]。我们认为这是第一个从随机OT中构建的具有Cardinality的隐私集合交点求和功能。请注意，我们的构造可以自然地修改为隐私计算PSI-cardinality的协议。

……

#### 4.3.2 基于布隆过滤器的协议

在本节中，我们描述了一个基于使用加密布隆过滤器的隐私集合交点求和协议，扩展了PSI方法[17]、[20]、[22]。

……

## 5 测量

在这一节中，我们介绍了第4.3.1节和第4.3.2节中介绍的我们的两个新的私有交集-和-cardinality协议的实现的测量结果，以及第3.1节中描述的我们部署的协议的额外测量结果，包括部署的协议和使用不同同态加密方案的变体。我们还将具体的成本与之前报道的基于乱码电路的方案的数字进行比较，特别是作品[31]、[49]、[50]、[52]，它们是在隐私交集上计算功能的最知名的作品。我们的比较包括基于 "批量计算 "场景的货币成本，使用表1中资源成本的GCP云定价。

在表3和表4中，我们以不同类型的操作和不同类型的传输元素的数量来表示每个协议的渐近成本。根据这些数字，我们预计DDH协议将有最好的通信，而在计算方面最有效的协议将取决于指数化和同态操作的相对成本，这一点我们通过实验来研究。

### 5.1 参数和加密方案

我们协议的所有计算成本测量都是以双方的总壁钟运行时间为基础的，运行在一台具有英特尔至强CPU E5-1650 v3（3.50 GHz）和32GB内存的台式工作站的单线程上，这与我们部署环境中的机器类似。计算成本不包括各方之间通过网络传输文件的时间。

对于所有的方案和数据库规模，我们假设输入域是128位字符串的集合，相关值最多为32位。我们还认为关联值的总和是以32比特为界限的。所有的计算成本都是假设每一方的输入中的每个条目都在集合的交集中（在所有协议中，这使计算量最大化）。

现在我们描述一下每个协议的加密方案和参数的选择。

……

### 5.2 测量的讨论

我们在表5中介绍了我们的测量结果，并在表6中介绍了货币成本。我们显示了基于DDH的已部署协议以及基于ROT和BF的两个新协议的成本，使用RLWE作为相关值的同态加密方案，还比较了我们的已部署协议，它使用DDH协议和Slotted Paillier作为加密方案（见第3.2节）。

我们看到，货币成本密切跟踪通信成本。使用Paillier的DDH协议具有最简洁的通信，也是最有效的货币成本，而ROT协议的货币成本和通信成本都要高出15倍，而基于BF的协议则要高出100倍。DDH协议，特别是用RLWE作为同态加密，被证明是我们计算效率最高的协议，比ROT和BF协议分别快25倍和40倍。最后，采用RLWE的DDH协议的货币成本比采用Paillier的DDH协议小11%，计算量减少约40%。

### 5.3 与混淆电路作品的比较

在本节中，我们将具体的成本（计算、通信和货币）与现有的基于乱码电路的工作中提出的成本进行比较，特别是[31]、[49]、[50]、[52]。对于这些成本，我们在很大程度上依赖于[50]的出色阐述，大量借鉴了[50]的表3和表5。

对于所有的Garbled Circuit协议，我们假设每一方的输入中的标识符被散列成 $40+\log(n)$ 比特长，其中n是输入大小：这可以防止除概率 $2^{-40}$ 以外的散列碰撞。

表7中列出了通信、计算和货币成本的比较。

我们注意到，由于几个原因，这些比较是不完美的。其中重要的一点是，[50]中提出的运行时间包括在局域网上的通信传输时间，而对于我们的协议，我们忽略了通信的时间，只包括计算的运行时间。这意味着我们在某种程度上高估了乱码电路式解决方案的计算成本。此外，测量使用的执行环境略有不同。另一点是，[50]中的乱码电路式解决方案的通信成本只是针对PSI功能，而不是针对私有交叉和。我们忽略了与计算相交和有关的额外成本，因此在某种程度上低估了Garbled-Circuit式解决方案的通信成本。

即使有这些注意事项，我们相信这个比较是有参考价值的，并且证明了我们的预期，即Garbled Circuit解决方案在计算上比我们提出的解决方案更快，但也产生了明显的通信成本。由于通信成本的巨大差异，在我们的成本模型中，这些协议的货币成本也要昂贵得多。

表7显示，基于ROT的协议和基于DDH的协议的两个变体，包括部署的协议，在货币方面比任何基于乱码电路的协议都要便宜。特别是，对于所考虑的数据大小，部署的协议比基于乱码电路的最便宜的协议[50]便宜20-30倍。我们基于布隆转换器的新协议也比除[50]之外的所有基于乱码电路的解决方案更便宜。

在本文新提出的协议中，就货币成本而言，基于DH的协议仍然是最便宜的。使用Paillier的DH协议（也就是我们部署的协议）在货币成本上比基于RLWE的变体要贵，但差别很小（大约10%）。同时，基于RLWE的协议在计算上要便宜40%。这意味着基于RLWE的协议在计算成本较高或通信成本比我们考虑的估值便宜的情况下可能特别有用。

## 6 总结

我们描述了在一个行业环境中部署一个安全的计算协议，作为不同公司之间业务互动的解决方案。我们的工作所解决的问题是保护隐私的综合广告转换的归属。我们描述了我们认为使这个问题很适合安全计算解决方案的因素，并描述了我们设计上的各种实际限制。

我们所部署的协议之所以被选中，是因为它的简单性，同时也是因为它的通信效率，这对货币成本有很大的影响。我们还根据最近的进展，重新审视了私人有底线的相交和问题，在此基础上我们构建了两个新的协议。我们实现了所有的构建，以评估和比较它们的具体成本，包括货币成本。从我们的测量结果来看，除了一个协议外，所有协议在货币成本方面与安全计算交集上的通用函数的方法相比都很好。我们部署的协议被发现在货币成本方面比通用方法便宜20倍。我们的其他解决方案提供了更好的计算，以换取通信。
