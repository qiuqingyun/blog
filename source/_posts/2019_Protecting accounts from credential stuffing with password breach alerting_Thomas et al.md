---
title: 用密码泄露警报来保护账户不被盗用
date: 2022-05-12
updated: 2022-05-12
description: 由于知识的不对称性，保护账户免受凭证填充攻击的工作仍然十分繁重：攻击者可以大范围地接触到数十亿被盗的用户名和密码，而用户和身份提供者对哪些账户需要补救仍然一无所知。在本文中，我们提出了一个保护隐私的协议，根据该协议，客户可以查询一个集中的漏洞库，以确定特定的用户名和密码组合是否公开暴露，但不透露查询的信息。在这里，客户端可以是一个最终用户，一个密码管理器，或一个身份提供者。为了证明我们协议的可行性，我们实现了一个云服务，该服务调解访问在漏洞中发现的40多亿个凭证，以及一个作为初始客户端的Chrome扩展。基于来自近67万名用户和2100万次登录的匿名遥测数据，我们发现网络上1.5%的登录涉及违…
---
# 用密码泄露警报来保护账户不被盗用

## 摘要

由于知识的不对称性，保护账户免受凭证填充攻击的工作仍然十分繁重：攻击者可以大范围地接触到数十亿被盗的用户名和密码，而用户和身份提供者对哪些账户需要补救仍然一无所知。在本文中，我们提出了一个保护隐私的协议，根据该协议，客户可以查询一个集中的漏洞库，以确定特定的用户名和密码组合是否公开暴露，但不透露查询的信息。在这里，客户端可以是一个最终用户，一个密码管理器，或一个身份提供者。为了证明我们协议的可行性，我们实现了一个云服务，该服务调解访问在漏洞中发现的40多亿个凭证，以及一个作为初始客户端的Chrome扩展。基于来自近67万名用户和2100万次登录的匿名遥测数据，我们发现网络上1.5%的登录涉及违规的凭证。通过提醒用户注意这种漏洞状态，我们26%的警告导致用户迁移到一个新的密码，至少与原来的密码一样强大。我们的研究说明了安全的、民主化的密码泄露警告可以帮助缓解账户劫持的一个方面。

## 1 介绍

数据泄露所暴露的用户名和密码的广泛可用性，使犯罪分子对数十亿账户的访问变得微不足道。仅在过去的两年里，像Antipublic（4.5亿个凭证）、Exploit.in（6亿个凭证）和Collection 1-5（22亿个凭证）这样的漏洞汇编已经稳步增长，因为它们的创建者聚集了地下论坛上分享的材料[21, 25]。尽管这些数据是公开的，但其效力不减。以前的研究表明，6.9%的被攻破的凭证由于重复使用而仍然有效，甚至在其最初暴露的多年后仍然有效[51]。如果没有深度防御技术将认证扩大到包括用户的位置和设备细节[12, 17]，劫持者只需要进行凭证填充攻击--试图用每一个被攻破的凭证登录，就可以隔离易受攻击的账户。

虽然用户（或身份提供者）可以通过重设账户密码来减轻这种劫持风险，但在实践中，发现哪些账户需要关注仍然是一个关键障碍。这就催生了像HaveIBeenPwned和PasswordPing这样的漏洞提醒服务，它们主动寻找被破坏的凭证来通知受影响的用户[26, 43]。目前，这些服务在用户隐私、准确性以及通过未经认证的公共渠道分享表面上的私人账户细节所涉及的风险方面做出了各种权衡。这些权衡的一个后果是，用户可能会因为误报而收到不准确的补救建议。例如，Firefox和LastPass都会检查用户名的泄露状态，以鼓励用户重设密码[13, 42]，但它们缺乏关于用户的密码是否真的在某个特定网站上被暴露，或者是否曾经被重设的背景。同样有问题的是，其他方案隐含地相信违约警报服务能够正确处理作为查询的一部分提供的明文用户名和密码。这使得违约警报服务在被破坏（或被证明是敌对的）的情况下成为一种责任。

在本文中，我们介绍了一个新的隐私保护协议的设计、实现和部署，该协议允许客户了解他们的用户名和密码是否出现在一个漏洞中，而不透露所查询的信息。与现有的方案相比，我们的协议有两个主要优势。首先，我们的设计考虑到了对抗性客户（例如，试图从我们的服务中窃取用户名和密码的攻击者）和对抗性服务器（例如，攻击者收集发送到服务的用户名和密码）的威胁。我们使用计算成本高的散列、匿名和私有集相交的组合来解决这些风险。其次，这些隐私要求使我们能够根据被破坏的证书数据库检查客户的确切用户名和密码（而不是目前只有用户名或只有密码），从而减少导致警告疲劳的假阳性。

为了证明我们协议的可行性，我们公开发布了一个Chrome扩展程序，当用户使用超过40亿个被攻破的用户名和密码之一登录网站时，会发出警告。虽然在理论上任何身份供应商或密码管理器都可以与我们的协议整合，但我们首先选择了浏览器内的警报，因为它可以扩展到长尾领域。在2019年2月5日至3月4日期间，来自世界各地的近67万名用户安装了我们的扩展。在这个测量窗口期间，我们检测到2100多万次登录中的1.5%由于依赖被破坏的凭证而存在漏洞，或者每两个用户就有一个警告。通过提醒用户注意这种漏洞状态，我们26%的警告导致用户迁移到新的密码。在这些新密码中，94%至少和原来的密码一样强大。

我们的扩展程序报告的匿名遥测数据显示，用户在超过74.6万个不同的域名上重复使用被破解的凭证。视频流和成人网站的劫持风险最高，其中3.6-6.3%的登录依赖于被破解的凭证。相反，用户似乎对密码安全建议进行了内化（或通过密码组成政策被迫这样做），特别是在金融和政府网站，只有0.2-0.3%的登录涉及被破坏的凭证。尽管各行业之间存在差异，但我们的分析显示，凭证堵塞的威胁已经延伸到互联网的长尾部分。如果没有新的认证形式，我们相信，关键是要让用户和身份提供者都能积极主动地重新确保他们的账户安全。

总之，我们将我们的主要贡献归纳如下：

- 我们开发并公开发布了一个新的协议，用于检测一个用户名和密码对是否出现在数据泄露中，而不透露被查询的信息。我们的协议改善了现有方案的隐私性，同时也降低了假阳性的风险。
- 我们概述了在实践中部署该方案的技术挑战，包括调解访问超过40亿个被破坏的用户名和密码所需的计算开销、延迟和成本。
- 基于现实世界的部署，我们发现整个网络上有1.5%的登录涉及被破坏的凭证。我们提醒这只是一个下限，因为登录不是唯一的。在我们的670,000个用户中，大约有二分之一的用户收到了警告。
- 用户对26%的警告的反应是重新设置他们的密码；94%的新密码和原来的密码一样强或更强。

## 2 背景和要求

首先，我们建立了支撑我们的漏洞警报协议的设计原则和威胁模型。我们将这些要求与HaveIBeenPwned和PasswordPing的现有解决方案以及相关的加密协议（如隐私信息检索和不经意传输）进行比较，以强调所有这些方法在隐私、开销、准确性和信任方面的权衡。

### 2.1 协议摘要

我们在图1中为我们的违约警报服务提供了一个抽象协议。我们在整个工作中重复使用这些函数名称和术语。在这里，一个可以访问用户名和密码元组 $(u, p)$ 的客户端通过 $CreateRequest(u, p)$ 执行一些计算，产生一个本地状态 $LS$ 和请求 $R_{eq}$，并将其发送给漏洞警报服务。该服务存储并定期更新不安全凭证的数据库 $S = \{(u_1, p_1), ...  , (u_n, p_n)\}$。收到请求后，服务器访问其凭证存储 $S$，运行 $CreateResponse(S, R_{eq})$，并将得到的响应发送到客户端。最后，客户端通过计算 $Verdict(R_{esp}, LS)$，得出所查询的凭证是否通过漏洞暴露的判断。由于新的漏洞会随着时间的推移而出现，客户应该定期重复这个过程，因为之前的判决可能不再有效。

### 2.2 设计原则

**民主化的访问**：目前，身份提供者单独收集被破坏的密码数据，以重置其受影响的用户账户[4, 58]。这无法扩展到所有的身份提供者，导致在各种服务和事件中的保护不完善。任何违约警报服务都应该被所有终端用户和身份提供者所访问，因此，不需要相关各方之间的信任。这意味着我们不能依赖认证账户作为一种速率限制的形式。我们在第2.3节的威胁模型中更正式地定义信任。

**可操作性，而不是信息性**：任何漏洞警报服务都应该为用户提供准确和可操作的安全建议，例如通过密码重置来重新确保账户的安全。仅仅警告客户存在暴露的数据，如客户的电子邮件地址、电话号码或物理地址的警报，缺乏直接的恢复步骤，因此不在我们的设计范围之内。同样，仅仅警告客户密码材料被暴露（而不是所涉及的具体密码）的警报可能会导致误报。

**被破坏，而不是薄弱**：只有当访问账户的所有必要信息（例如，用户名和密码）被暴露时，才应该触发警报。虽然破解字典（通常由被破解的密码组成）可能包括客户的弱口令，可猜测的口令，任何后续的攻击可能需要多次猜测，因此代表的威胁比完全的凭证暴露小。我们假设大多数在线服务采用足够的节流措施，使这种暴力破解不切实际。相反，针对确切的用户名和密码对的攻击在野外被积极部署。事实上，Thomas等人的研究表明，拥有被第三方破坏的非陈旧凭证的用户被劫持的可能性是随机用户的十倍[51]。我们强调被攻破的凭证有助于我们优先考虑稀缺的用户注意力[5]，并避免类似于其他警告模型的潜在警告疲劳[2]。虽然将用户迁移到更强的密码上仍然是一项重要的任务，但它不在我们设计的范围之内。

**近乎实时**：客户端查询凭证和了解其违规状态之间的时间应接近实时，以便于直接与账户安全流、密码管理器或在密码输入时整合。这可能会限制任何协议所提供的隐私保护水平，因为所涉及的任何加密基元的计算开销和网络延迟。

### 2.3 威胁模型

