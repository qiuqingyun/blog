---
title: 论安全计算的部署：具有Cardinality的隐私集合交点求和问题 Part1
---

## 摘要

在这项工作中，我们讨论了我们在行业内部署加密安全计算协议的成功努力。我们考虑的问题是隐私计算广告活动的总转换率。这个基础功能可以被抽象为具有Cardinality的私人交叉和（PI-Sum）。在这种情况下，两方持有包含用户标识符的数据集，其中一方还拥有与其每个用户标识符相关的整数值。双方希望了解他们共同拥有的标识符的数量以及与这些用户相关的整数值的总和，而不透露任何有关他们私人输入的信息。

我们确定了主要的特性和有利因素，这些特性和因素使得部署一个加密协议成为可能、实用，并被独特地定位为手头任务的一个解决方案。我们描述了我们的部署环境和最相关的效率衡量标准，在我们的环境中，它是通信开销而不是计算。我们还提出了一个货币成本模型，可以作为一个统一的成本衡量标准，以及反映我们使用情况的计算模型：一个低优先级的批量计算。

我们提出了三个带cardinality的PI-Sum协议：我们目前部署的协议，它依赖于Diffie-Hellman风格的双重掩码，以及两个新的协议，它们利用了最近的私有集相交（PSI）技术，使用不经意传输和加密的Bloom过滤器。当用不同的加法同态加密方案进行实例化时，我们将后面两个协议与我们的原始解决方案进行比较。我们实现了我们的构造并比较了它们的成本。我们还与最近用于计算两个数据集的交集的通用方法进行了比较，结果表明，我们最好的协议的货币成本比已知的最佳通用方法低20倍。

## 1 介绍

安全的多方计算(MPC)长期以来一直致力于实现对来自多个来源的数据的联合分析，同时保持每个输入源的隐私。在过去的十年中，该领域的最新发展显示了令人印象深刻的效率改进，表明这一承诺超越了可行性的结果，进入了实际的实施。然而，这种技术在实际工业环境中的应用却非常有限。
在本文中，我们介绍了我们在一个特定的商业应用中使用加密MPC技术的工作：归属总的广告转换。我们的解决方案已经在实践中使用了几年，在本文中我们讨论了我们在这个问题上部署和使用MPC解决方案所遇到的各种限制，以及这些限制如何影响我们选择实施的加密协议。我们的应用问题与私有集交集（PSI）问题有相似之处，但我们需要的确切功能是PSI问题的扩展，我们称之为有心性的私有集交集和。然而，由于PSI的技术水平已经有了巨大的进步[11]、[31]、[37]、[47]、[49]、[51]、[55]，通常以我们的商业场景作为实际应用的例子，在这项工作中，我们考虑最近有效的PSI构建方法以及如何将它们扩展到我们设置的解决方案。在低优先级的 "批量计算 "环境中执行时，我们将这些构造的效率成本与我们原来的解决方案的效率成本进行比较，因为在这种环境中不需要实时得到结果。我们通过使用云供应商对计算和网络资源收取的价格来模拟货币成本，我们发现这是对我们部署环境中的成本的良好近似。这种约束与安全计算领域的大多数工作所考虑的约束不同，这些工作通常侧重于最小化端到端的运行时间。

**广告转换**：当用户在某个网站上看到某个公司的在线广告，然后在该公司的商店里进行购买时，就会发生广告转换。投放广告的公司想知道它有多少收入可以归功于其在线广告活动。然而，计算这些归因统计所需的数据是由两方分担的：广告供应商和公司，前者知道哪些用户看过某个特定的广告，后者知道谁购买了产品以及他们花了多少钱。这两方可能不愿意或无法公开基础数据，但双方仍希望计算出一个总体的人口水平测量：有多少用户看到了广告并进行了相应的购买，以及这些用户总共花费了多少钱。他们希望在做到这一点的同时，确保在输入的数据集中，除了这些总量值之外，没有任何关于个人用户的信息被披露。

**具有Cardinality的隐私集合交点求和**：抽象地讲，上述问题可以被看作是私有集交集问题的一个变种，我们称之为具有Cardinality的隐私集合交点求和问题。在这种情况下，有两方拥有由标识符组成的私有输入集，其中一方还拥有与每个标识符相关的整数值。双方希望了解两个输入集的交集中所有标识符的相关整数值的总和，以及交集的cardinality（或大小），但除此之外就没有了。特别是，任何一方都不应该了解交集中的实际标识符，也不应该了解关于另一方数据的任何额外信息（除了他们的输入集的大小），例如比交集上的总数更细的相关值。此外，双方可以选择以交集的最小阈值大小为条件来揭示交集的总和。

对于广告转换测量用例，一方持有的标识符对应于看过广告活动的用户，而另一方持有的标识符和整数值分别对应于购买相关物品的用户和他们花费的金额。虽然广告转换问题是一个可以用私有交叉和协议解决的例子场景，但这个功能的适用范围更广。它可以很容易地扩展到其他统计数据，如平均值和方差。更广泛地说，PSI-Sum协议提供了一个安全的解决方案，适用于任何一方持有关于用户的私人统计数据，另一方持有关于特定人群中的用户成员的私人知识，并且双方都想了解该特定人群的总体统计数据的情况。例如，人们可以回答这样的问题："服用特定药物的病人的平均血压是多少？"或 "居住在特定邮政编码的人的住房拥有率是多少？"。

**贡献**：我们的贡献有两个方面。首先，我们详细描述了我们的部署，包括我们选择解决方案的约束和限制因素。这包括讨论安全聚合广告转换业务问题的特点，使其成为基于加密的MPC解决方案的良好候选。这些因素包括隐私需求和强大的商业利益，但也包括使用有效技术的问题的可操作性。该解决方案的关键制约因素是简单性和可解释性，以及易于实施、易于维护和可扩展性。

我们讨论了我们部署的协议的细节，该协议基于[41]的经典集合交叉协议，该协议使用Pohlig-Hellman密码（基于Decisional Diffie-Hellman（DDH）的难度）--该功能也可以被视为具有共享密钥的不经意PRF[34]。聚合属性是通过使用加法同态加密实现的。我们描述了典型的日常工作负载，以及运行这些工作负载的成本，包括货币成本。我们观察到，我们的应用不是实时的，可以使用廉价的低优先级的、可抢占的计算。在这种 "批量计算 "的环境中，带宽仍然是一种稀缺的共享资源，多个应用程序都在竞争（各种云供应商的资源价格见表1）。因此，通信复杂度成为我们协议最相关的效率衡量标准。我们相信，我们的见解对那些试图将安全计算技术用于实践的人来说是有用的。

作为我们的第二个主要贡献，我们通过最近大量改善高效PSI协议现状的论文[11], [31], [37], [47], [49], [51], [55]的视角，重新审视了具有Cardinality的隐私集合交点求和问题，以便将潜在的新解决方案的效率成本与我们部署的实现中使用的DDH风格协议进行比较。 我们的目标是看更多的现代技术是否能以增加复杂性为代价导致显著的节省。为此，我们将成本与最近的一套基于混淆电路式的技术[11]、[31]、[32]、[51]进行比较，这些技术明确考虑了交点上的隐私计算功能，并且可以直接扩展到计算我们的功能。我们还研究了最近计算隐私集合交集的方法[17], [20], [22], [37], [47], [49], 并试图使它们适应于计算具有Cardinality的隐私集合交点求和。

虽然最初的具有Cardinality的隐私集合交点求和功能看起来非常接近PSI功能，它安全地计算两个输入集的交集，但事实证明，在隐藏交集的同时实现额外的聚合是有效率成本的。同时，PSI功能是扩展功能的安全协议中的一个隐含的必要构件。因此，最近的PSI方法[17]、[20]、[22]、[37]、[47]、[49]需要明显不同的技术，以适应有cardinality的PSI-Sum设置。我们将调整工作集中在这些工作中的两个主要方法上。第一种是基于随机不经意传输，并建立在[49]和[37]所开发的技术上。这种方法利用了不经意PRF技术（OPRF），我们在两步不经意评估中对其进行了扩展，允许对评估的输入进行秘密置换。这使我们能够隐藏交集中的元素的身份。为了促进聚合功能，我们利用了加法同态加密，正如我们部署的协议一样。第二个协议是基于加密布隆过滤器的，并受到最近几个PSI解决方案的启发[17]、[20]、[22]。我们构建了一个不经意协议，用于在加性同态加密下评估加密布隆过滤器的成员资格。我们还使用加性同态加密来实现聚合功能。除了这两个新的构造，我们还给出了一个配方，用于将一个普通形式的PSI协议转换为计算具有Cardinality的隐私集合交点求和的协议。我们称这个配方为 "标签、洗牌、聚合"，并认为它适用于一类广泛的较新的方法。

此外，在我们上面总结的两个新的隐私集合交点求和协议，以及我们部署的协议中，输出接收方是拥有输入标识符和值对的一方。我们还构建了协议的 "反向 "变体，将输出接收方改为只有标识符的输入集的一方。我们所有的构造都实现了安全的计算功能，并对半诚实的对手具有安全性。

所有三个协议都使用加法同态加密（HE）作为构建模块。虽然我们部署的实现使用了Paillier[46]加密，并由于Damgard-Jurik[16]的优化，这在当时提供了最好的效率保证，但最近基于格子的构造的效率有了很大的提高[8]、[9]、[24]、[29]。我们将这两种方案与现有的第三种加法同态加密方案ElGamal[23]一起考虑，以进行综合比较，并分析我们的协议在与每个加法HE方案实例化时的效率权衡。

我们实现了我们所描述的每一个协议，并对它们在计算、通信和货币成本方面的性能进行了比较，同时也与最近使用混淆电路式技术对两个数据集的交集进行通用计算的协议进行了比较[11]、[31]、[50]。我们发现，在这些协议中，使用Paillier作为同态加密的DDH式协议实现了最低的货币成本，在10万个元素的输入集上需要0.084美分（USD）。我们还发现，我们针对PI-Sum的DDHstyle协议的变体，使用RLWE同态加密的关联值，在大小为100,000的集合上花费的时间少了约40%（47.4秒对74.4秒），货币成本减少了11%，为0.075美分。此外，我们所有的协议（DDH、ROT和Bloom Filter）在货币成本方面都超过了[11]和[31]的通用方法。[50]的方法优于我们基于布隆过滤器的解决方案，但在货币成本上比基于ROT和DDH的解决方案更昂贵。总的来说，在我们已经确定的限制条件下，部署的DDH协议仍然是我们的最佳选择。具体来说，基于部署的DDH协议的货币成本比任何基于混淆电路的新型通用方法都要便宜20倍。

**路线图**：在第2节中，我们详细讨论了我们问题的实际设置。在第3节中，我们给出了我们所部署的协议的细节。在第4节中，我们根据PSI的最新进展，重新审视了具有Cardinality的隐私集合交点求和问题。我们概述了最近的PSI方法，并在第4.2节中提出了将PSI协议转化为具有Cardinality的隐私集合交点求和的秘诀。在第4.3节中，我们提出了两个使用新技术的新构造。我们所有的构造都使用了附录A中定义的几个加密基元。在第5节中，我们介绍了我们的协议实现的测量结果，包括基于货币成本与基于混淆电路技术的工作进行比较。在附录A中，我们给出了各种有用的符号和定义。在附录B中，我们讨论了使用不同加密方案来实例化我们的协议的权衡。
